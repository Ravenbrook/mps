# .cirrus.yml -- Cirrus CI configuration for the MPS

# FIXME: Just a test based on https://cirrus-ci.org/guide/macOS/

XCA6LL_task:
  macos_instance:
    # What does this syntax mean?  See <https://github.com/cirruslabs/cirrus-ci-docs/discussions/1147#discussioncomment-4902556>.
    image: ghcr.io/cirruslabs/macos-ventura-xcode
  script:
    - uname -a
    - cc --version
    - cc -dumpmachine
    - ./configure --prefix=$PWD/prefix && make install && make test

# https://cirrus-ci.org/guide/writing-tasks/ doesn't seem to allow for FreeBSD on arm64

FRI6LL_task:
  freebsd_instance:
    # Why is this a "family"?  See <https://github.com/cirruslabs/cirrus-ci-docs/discussions/1147#discussioncomment-4902556>.
    image_family: freebsd-13-1
  script: |
    CC=clang
    uname -a
    pkg install -y gmake $CC
    $CC --version
    $CC -dumpmachine
    CC=$CC ./configure --prefix=$PWD/prefix-clang && make install && make test

# FRA6LL doesn't seem to work.  Cirrus CI gets an "Agent is not
# responding!" error on its status page.

FRA6LL_task:
  freebsd_instance:
    image_family: freebsd-13-1
    architecture: arm64
  script: |
    CC=clang
    uname -a
    pkg install -y gmake $CC
    $CC --version
    $CC -dumpmachine
    CC=$CC ./configure --prefix=$PWD/prefix-clang && make install && make test

FRI6GC_task:
  freebsd_instance:
    image_family: freebsd-13-1
  script: |
    CC=gcc
    uname -a
    pkg install -y gmake $CC
    $CC --version
    $CC -dumpmachine
    CC=$CC ./configure --prefix=$PWD/prefix-clang && make install && make test

# Is this really "LI" if it's a docker container?  Does it matter?
LIA6GC_task:
  arm_container:
    image: gcc # https://hub.docker.com/_/gcc
  script:
    - uname -a
    - gcc --version
    - gcc -dumpmachine
    - CC=gcc ./configure --prefix=$PWD/prefix && make install && make test

LIA6LL_task:
  arm_container:
    image: ubuntu # https://hub.docker.com/_/ubuntu
  script: |
    CC=clang
    uname -a
    apt-get update
    apt-get install -y gmake $CC
    $CC --version
    $CC -dumpmachine
    CC=$CC ./configure --prefix=$PWD/prefix && make install && make test
