.. mode: -*- rst -*-

LO pool class
=============

:Tag: design.mps.poollo
:Author: David Jones
:Date: 1997-03-07
:Status: incomplete document
:Revision: $Id$
:Copyright: See `Copyright and License`_.
:Index terms:
   pair: LO pool class; design
   single: pool class; LO design


Introduction
------------

_`.readership`: Any MPS developer.

_`.intro`: The LO (Leaf Object) pool class is a pool class originally
developed for DylanWorks. It is designed to manage objects that have
no references (leaf objects) such as strings, bit tables, etc, that
must not move in memory. It is a garbage collected pool: objects
allocated in the pool are automatically reclaimed when they are
discovered to be unreachable.


Definitions
-----------

_`.def.leaf`: A "leaf" object is an object that contains no
references, or an object all of whose references refer to roots. That
is, any references that the object has must refer to a priori alive
objects that are guaranteed not to move, hence the references do not
need fixing.

_`.def.grain`: A grain (of some alignment) is a contiguous aligned
area of memory of the smallest size possible (which is the same size
as the alignment).


Requirements
------------

_`.req.source`: See req.dylan.fun.obj.alloc and
req.dylan.prot.ffi.access.

_`.req.leaf`: The pool must manage formatted leaf objects (see
`.def.leaf`_ above for a definition). This is intended to encompass
Dylan and C leaf objects. Dylan leaf objects have a reference to their
wrapper, but are still leaf objects (in the sense of `.def.leaf`_)
because the wrapper will be a root.

_`.req.nofault`: The memory containing objects managed by the pool
must not be protected. The client must be allowed to access these
objects without incurring MPS exceptions.


Overview
--------

_`.overview.ms`: The LO Pool is a non-moving mark-and-sweep collector.

_`.overview.ms.justify`: Mark-and-sweep pools are simpler than moving
pools.

_`.overview.alloc`: Objects are allocated in the pool using the
reserve/commit protocol on allocation points.

_`.overview.format`: The pool is formatted.


Interface
---------

_`.if.init.format`: The init method requires one keyword argument,
``MPS_KEY_FORMAT``, whose value must be ``Format`` with a skip method.

_`.if.init.format.use`: The pool uses the skip and alignment slots of
the format. The skip method is used to determine the length of objects
(during reclaim). The alignment field is used to determine the
granularity at which memory should be managed.


Document History
----------------

- 1997-03-07 David Jones. Incomplete document.

- 2002-06-07 RB_ Converted from MMInfo database design document.

- 2013-05-23 GDR_ Converted to reStructuredText.

.. _RB: https://www.ravenbrook.com/consultants/rb/
.. _GDR: https://www.ravenbrook.com/consultants/gdr/


Copyright and License
---------------------

Copyright © 2013–2020 `Ravenbrook Limited <https://www.ravenbrook.com/>`_.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:

1. Redistributions of source code must retain the above copyright
   notice, this list of conditions and the following disclaimer.

2. Redistributions in binary form must reproduce the above copyright
   notice, this list of conditions and the following disclaimer in the
   documentation and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
