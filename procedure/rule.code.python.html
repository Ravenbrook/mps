<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>

<title>Rules for source code in Python</title>

</head>

<body>

<div align="center">

<p>
<a href="/">Ravenbrook</a> /
<a href="/rule/">Rules</a> /
<a href="/rule/code/">Source code</a>
</p>

<hr />

<h1>Rules for source code in Python</h1>

<address>
<a href="mailto:gdr@ravenbrook.com">Gareth Rees</a>,
<a href="https://www.ravenbrook.com/">Ravenbrook Limited</a>,
2001-05-23
</address>

</div>


<h2><a id="section-1" name="section-1">1. Introduction</a></h2>

<p> This document is a ruleset which can be applied to Python source
code.  It is intended for use with an inspection procedure [<a
href="#ref-Gilb-1995">Gilb 1995</a>] but can also be used for general
guidance and review. </p>

<p> The intended readership is Ravenbrook staff, but these rules can
used by anyone. </p>

<p> This document is not confidential. </p>


<h2><a id="section-2" name="section-2">2. Rules</a></h2>

<table>

<tr valign="top">

  <td><a id="rule-compatible" name="rule-compatible" href="#justification-compatible">compatible</a></td>

  <td>Write code that's compatible with Python version 1.5.2 and all later versions.</td>

</tr>

<tr valign="top">

  <td><a id="rule-global" name="rule-global" href="#justification-global">global</a></td>

  <td>Use global variables only for read-only data.</td>

</tr>

<tr valign="top">

  <td><a id="rule-instance" name="rule-instance" href="#justification-instance">instance</a></td>

  <td>Assign modifiable instance variables in a class's <code>__init__</code> method, not in the class definition at top level.</td>

</tr>

<tr valign="top">

  <td><a id="rule-joining" name="rule-joining" href="#justification-joining">joining</a></td>

  <td>Don't use a backslash to join two lines unless you have to.</td>

</tr>

<tr valign="top">

  <td><a id="rule-unittest" name="rule-unittest" href="#justification-unittest">unittest</a></td>

  <td>Use the Python unit test framework for your tests.</td>

</tr>

</table>


<h2><a id="section-3" name="section-3">3. Justification and commentary</a></h2>


<h3><a id="justification-compatible" name="justification-compatible" href="#rule-compatible">compatible</a></h3>

<p> It's very annoying to have to upgrade your Python installation in
order to run a program.  Requiring the newest version of Python could be
a barrier to a customer (who already has a Python installation) using a
program. </p>

<p> Of course, this may not be possible, because you require a feature
that's only available in a newer version.  If so, document this clearly
in the introduction to the module, package or product. </p>

<p> Main points to note: </p>

<ol>

<li> Don't rely on nested environments (introduced in Python 2.1 [<a
title="What's New in Python 2.1"
href="http://www.amk.ca/python/2.1/index.html#SECTION000300000000000000000">Kuchling
2001a, 2</a>]).  Pass in the environment you need as arguments to the
locally declared function or the <code>lambda</code> expression. </li>

<li> Don't use the augmented assignment operators <code>+=</code>,
<code>-=</code>, <code>*=</code> and so on (introduced in Python 2.0 [<a
title="What's New in Python 2.0"
href="http://www.python.org/2.0/new-python.html#SECTION000700000000000000000">Kuchling
2000, 6</a>]).  Write <code>a = a + b</code> instead of <code>a +=
b</code>. </li>

<li> Don't rely on garbage collection of cycles (introduced in Python
2.0 [<a title="What's New in Python 2.0"
href="http://www.python.org/2.0/new-python.html#SECTION000900000000000000000">Kuchling
2000, 8</a>]).  Break the cycle explicitly. </li>

<li> Be careful with the division operator on integers; in Pythons
before 3.0 it returns the floor of the result; from Python 3.0
<code>x/y</code> will mean <code>float(x)/float(y)</code> [<a
title="What's New in Python 2.2"
href="http://www.amk.ca/python/2.2/index.html#SECTION000500000000000000000">Kuchling
2001b</a>].  Use <code>int(math.floor(x/y))</code> if you want the old
meaning, or <code>float(x)/float(y)</code> if you want the new
meaning.  (In a few cases it doesn't matter.) </li>

</ol>


<h3><a id="justification-global" name="justification-global" href="#rule-global">global</a></h3>

<p> Python's scope rules [<a title="Python Reference Manual (Python
2.0)" href="http://www.python.org/doc/2.0/ref/execframes.html">Python
2000-10-16, 4.1</a>] mean that a mention of variable in a function
definition may refer either to a local variable or a global variable,
depending on whether the variable is assigned to anywhere in the
function definition, unless you remember to specify <code>global
<i>variable</i></code>.  This is a source of hard-to-discover
defects. </p>

<p> Instead of using global variables, make classes and turn your global
variable into instance variables (but don't forget the <a
href="#rule-instance">instance</a> rule).  This also has the advantage
of making it possible for several instances of your code to run at the
same time, thus meeting rule <a
href="/rule/code/#rule-adaptable">code/adaptable</a>. </p>


<h3><a id="justification-instance" name="justification-instance" href="#rule-instance">instance</a></h3>

<p> Python's object instantiation rules [<a title="Python Reference
Manual (Python 2.0)"
href="http://www.python.org/doc/2.0/ref/class.html">Python 2000-10-16,
7.6</a>] mean that variables declared at top level in a class are shared
between all instances of the class.  That's OK for non-modifiable
variables (for example, <code>i = 1</code>) because an assignment to a
class variable actually creates an instance variable that shadows the
class variable.  But for lists, dictionaries and other modifiable
objects you may be surprised when you find out that your list is shared
between all instances of the class. </p>


<h3><a id="justification-joining" name="justification-joining" href="#rule-joining">joining</a></h3>

<p> Backslashes don't cope with code reformatting.  You can usually
arrange for lines to be join implicitly by adding extra parentheses. </p>

<p> Sometimes this can't be done, for example the <code>raise</code> and
<code>print</code> statements sometimes need backslashes.  But consider
putting the long expression in a variable. </p>


<h3><a id="justification-unittest" name="justification-unittest" href="#rule-unittest">unittest</a></h3>

<p> The Python unit test framework [<a title="PyUnit - a unit testing
framework for Python" href="http://pyunit.sourceforge.net/">PyUnit</a>]
is the standard way of developing sets of unit tests.  (It is
distributed with Python 2.1, but needs to be downloaded and installed if
you have an earlier Python. </p>

<p> Using PyUnit makes it easier to collect sets of tests into test
suites and to pick out individual tests and run them. </p>


<h2><a id="section-A" name="section-A">A. References</a></h2>

<table>

<tr valign="top">

  <td>[<a id="ref-GDR-2001-05-25" name="ref-GDR-2001-05-25" href="/rule/code/style/">GDR 2001-05-25</a>]</td>

  <td>
    "Rules for source code style";
    <a href="mailto:gdr@ravenbrook.com">Gareth Rees</a>;
    <a href="https://www.ravenbrook.com/">Ravenbrook Limited</a>;
    2001-05-25.
  </td>

</tr>

<tr valign="top">

  <td>[<a id="ref-Gilb-1988" name="ref-Gilb-1988">Gilb 1988</a>]</td>

  <td>
    "Principles of Software Engineering Management";
    Tom Gilb;
    <a href="http://www.awl.com/">Addison-Wesley</a>;
    1988;
    ISBN 0-201-19246-2.
  </td>

</tr>

<tr valign="top">

  <td>[<a id="ref-Gilb-1995" name="ref-Gilb-1995">Gilb 1995</a>]</td>

  <td>
    "Software Inspection";
    Tom Gilb, Dorothy Graham;
    <a href="http://www.awl.com/">Addison-Wesley</a>;
    1995;
    ISBN 0-201-63181-4.
  </td>

</tr>

<tr valign="top">

  <td>[<a id="ref-Kuchling-2000" name="ref-Kuchling-2000" href="http://www.python.org/2.0/new-python.html">Kuchling 2000</a>]</td>

  <td>
    "What's New in Python 2.0";
    <a href="mailto:amk1@bigfoot.com">A M Kuchling</a>
    and <a href="mailto:moshez@math.huji.ac.il ">Moshe Zadka</a>;
    2000.
  </td>

</tr>

<tr valign="top">

  <td>[<a id="ref-Kuchling-2001a" name="ref-Kuchling-2001a" href="http://www.amk.ca/python/2.1/">Kuchling 2001a</a>]</td>

  <td>
    "What's New in Python 2.1";
    <a href="mailto:amk1@bigfoot.com">A M Kuchling</a>;
    2001.
  </td>

</tr>

<tr valign="top">

  <td>[<a id="ref-Kuchling-2001b" name="ref-Kuchling-2001b" href="http://www.amk.ca/python/2.2/">Kuchling 2001b</a>]</td>

  <td>
    "What's New in Python 2.2";
    <a href="mailto:amk1@bigfoot.com">A M Kuchling</a>;
    2001.
  </td>

</tr>

<tr valign="top">

  <td>[<a id="ref-PyUnit" name="ref-PyUnit" href="http://pyunit.sourceforge.net/">PyUnit</a>]</td>

  <td>
    "PyUnit - a unit testing framework for Python";
    <a href="mailto:stephen_purcell@yahoo.com">Steve Purcell</a>.
  </td>

</tr>

<tr valign="top">

  <td>[<a id="ref-Python-2000-10-16" name="ref-Python-2000-10-16" href="http://www.python.org/doc/2.0/ref/ref.html">Python 2000-10-16</a>]</td>

  <td>
    "Python Reference Manual (Python 2.0)";
    <a href="mailto:python-docs@python.org">Guido van Rossum</a>;
    2000-10-16.
  </td>

</tr>

<tr valign="top">

  <td>[<a id="ref-RB-2001-05-24" name="ref-RB-2001-05-24" href="https://info.ravenbrook.com/mail/2001/05/24/12-34-31/0.txt">RB 2001-05-24</a>]</td>

  <td>
    "Re: Rules for Python";
    <a href="mailto:rb@ravenbrook.com">Richard Brooksby</a>;
    <a href="https://www.ravenbrook.com/">Ravenbrook Limited</a>;
    2001-05-24.
  </td>

</tr>

</table>


<h2><a id="section-B" name="section-B">B. Document History</a></h2>

<table>

<tr valign="top">

  <td>2001-05-23</td>

  <td><a href="mailto:gdr@ravenbrook.com">GDR</a></td>

  <td>Created based on outcome of informal inspection.</td>

</tr>

<tr valign="top">

  <td>2001-05-25</td>

  <td><a href="mailto:gdr@ravenbrook.com">GDR</a></td>

  <td>Moved style rule to [<a title="Rules for source code style" href="/rule/code/style/">GDR 2001-05-25</a>], following the advice in [<a title="Re: Rules for Python" href="https://info.ravenbrook.com/mail/2001/05/24/12-34-31/0.txt">RB 2001-05-24</a>].</td>

</tr>

<tr valign="top">

  <td>2001-08-15</td>

  <td><a href="mailto:gdr@ravenbrook.com">GDR</a></td>

  <td>Added warning about compatibility of division operator between Python versions.</td>

</tr>

</table>


<hr />

<div align="center">

<p><small>Copyright &copy; 1998-2001 Ravenbrook Limited.  Ravenbrook Company
Confidential.</small></p>

<p><code>$Id: //info.ravenbrook.com/rule/code/index.html#3 $</code></p>

<p>
<a href="/">Ravenbrook</a> /
<a href="/rule/">Rules</a> /
<a href="/rule/code/">Source code</a>
</p>

</div>

</body>

</html>
